# NC旋盤 技術知見リファレンス

NC旋盤プログラミングと座標計算に必要な知識を体系的にまとめたドキュメントです。
本座標計算アプリケーションの開発・保守において参照すべき基礎知識をカバーしています。

---

# 第1部: 基礎知識

## 1. NC旋盤の座標系

### 1.1 基本軸構成

```
     Z+（テールストック方向）
      ↑
      │    ワーク（回転中）
      │   ┌────────┐
X+ ←──┼───┤        │──── 主軸中心
      │   └────────┘
      ▼
     Z-（チャック方向）
```

| 軸 | 方向 | 正方向(+) |
|----|------|-----------|
| **X軸** | 径方向 | ワークから離れる方向 |
| **Z軸** | 長手方向 | テールストック方向 |

### 1.2 加工原点

- **X = 0**: ワーク中心線
- **Z = 0**: ワーク右端面（仕上がり端面）

### 1.3 直径指令と半径指令 ★重要★

| 指令方式 | 説明 | 使用NC |
|---------|------|--------|
| **直径指令** | X値 = 直径値 | FANUC（多数派） |
| **半径指令** | X値 = 半径値 | 一部SIEMENS |

**I値は常に半径値で指定** (直径指令でも)

---

## 2. 基本Gコード

| コード | 名称 | 機能 |
|--------|------|------|
| **G00** | 位置決め | 早送り（非切削） |
| **G01** | 直線補間 | 切削送りで直線移動 |
| **G02** | 円弧CW | 時計回り円弧 |
| **G03** | 円弧CCW | 反時計回り円弧 |
| **G40** | 補正キャンセル | ノーズR補正解除 |
| **G41** | 左オフセット | 進行方向左に補正 |
| **G42** | 右オフセット | 進行方向右に補正 |

### G02/G03 回転方向

```
     Z-
      ↑
      │   G03(CCW)
 X- ←─●─→ X+
      │   G02(CW)
      ▼
     Z+
```

---

## 3. 工具の基本構造

### 3.1 バイト各部

- **すくい面**: 切りくずが流れる面
- **逃げ面**: 加工面との干渉を避ける面
- **切れ刃**: 材料を削る稜線
- **ノーズ**: コーナー部（ノーズR = 丸み半径）

### 3.2 重要な角度

| 名称 | 影響 |
|------|------|
| **すくい角** | 大→切れ味↑・強度↓ |
| **逃げ角** | 小すぎると加工面に干渉 |
| **主切刃角** | 切りくず厚さ・切削抵抗 |

### 3.3 ノーズR

- 一般的な値: 0.2, 0.4, 0.8, 1.2 mm
- 大きい → 刃先強度↑、仕上げ面↑、ビビリ発生しやすい
- 小さい → 精密加工向き、欠けやすい

### 3.4 チップ形状

| 記号 | 頂角 | 用途 | 干渉リスク |
|------|------|------|-----------|
| **CNMG** | 80° | 荒加工 | やや高い |
| **DNMG** | 55° | 仕上げ | 低い |
| **VNMG** | 35° | 複雑形状 | 最も低い |

---

## 4. 加工の種類

| 加工 | 特徴 |
|------|------|
| **外径加工** | ワーク外周を削る基本加工 |
| **内径加工** | 穴の内面を削る。ビビリ注意 |
| **端面加工** | ワーク端面を平坦に仕上げ |
| **溝入れ** | Oリング溝等。**工具幅**が重要 |
| **ねじ切り** | 主軸回転と送りを同期 |

---

## 5. 工具オフセット

### 5.1 幾何補正

工具の実際寸法と基準工具との差を補正

### 5.2 摩耗補正

工具摩耗による寸法変化を微調整

### 5.3 仮想刃先点番号

```
      8      1      2
       ╲     │     ╱
    7──+── 0 ──+──3  ← 外径加工で多用
       ╱     │     ╲
      6      5      4
```

| 番号 | 向き | 用途 |
|------|-----|------|
| 3 | +X | 外径加工（標準） |
| 2 | +X, +Z | 内径加工 |

---

# 第2部: 座標計算

## 6. 絶対座標と相対座標

| 方式 | Gコード | 基準点 |
|------|--------|--------|
| **絶対座標** | G90 | 加工原点（固定） |
| **相対座標** | G91 | 現在位置 |

**NC旋盤での相対座標アドレス:**
- U: X軸の相対移動量
- W: Z軸の相対移動量

---

## 7. テーパー座標計算

### 7.1 基本計算式

```
tan(α) = (D - d) / (2 × L)

D: 大径、d: 小径、L: テーパー長さ
```

### 7.2 テーパー比

テーパー比 1:N の場合:
```
角度 = arctan(1 / (2 × N))
```

---

## 8. 円弧座標計算 ★最重要★

### 8.1 I/K値の計算

```
I = (Xc - Xs) / 2    ← 半径値！
K = Zc - Zs

Xs, Zs: 円弧始点
Xc, Zc: 円弧中心
```

**なぜIを2で割るか?**
- X座標は直径指令だが、I値は**半径値**で指定
- これがNC旋盤の仕様

### 8.2 計算例

始点(X60, Z-20)、中心(X80, Z-20) の場合:
```
I = (80 - 60) / 2 = 10
K = -20 - (-20) = 0

→ G02 X80.0 Z-30.0 I10.0 K0 F0.1;
```

---

## 9. 角R・隅Rの座標計算

### 9.1 重要: 計算式が異なる

| 項目 | 角R（凸） | 隅R（凹） |
|------|----------|----------|
| 円弧中心 | コーナーの内側 | コーナーの外側 |
| 接点距離 | R / tan(θ/2) | **R × tan(θ)** |
| G02/G03 | 進行方向で判定 | 角Rと逆 |

### 9.2 テーパーから角Rへの接点

```
接点のZ補正 = R × tan(θ/2)
```

### 9.3 テーパーから隅Rへの接点

```
接点のX補正 = R × tan(θ)  ← 全角を使用！
```

---

## 10. 溝入れの座標計算

### 10.1 工具基準点

```
        工具幅 W
    ├──────────┤
    ●          ● 
   左端基準   右端基準
```

基準位置によってZ座標が異なる

### 10.2 溝底R（隅R）

**左側R（-Z方向進入時）:**
```
I = 0
K = -R
Gコード = G02
```

**右側R:**
```
I = 0
K = R
Gコード = G03
```

---

# 第3部: ノーズR補正

## 11. G41/G42の正しい判定

### 11.1 判定の原則

**「外径=G42」の単純暗記は危険**

正しい判定:
1. 工具の進行方向を確認
2. 進行方向から見てワークがどちら側か

```
G41: ワークが右側 → 工具は左にオフセット
G42: ワークが左側 → 工具は右にオフセット
```

### 11.2 判定マトリクス

| 刃物台 | 加工 | 切削方向 | コード |
|--------|-----|---------|--------|
| 前 | 外径 | -Z | G42 |
| 前 | 内径 | -Z | G41 |
| 後 | 外径 | -Z | G41 |
| 後 | 内径 | -Z | G42 |

---

## 12. G02/G03と機械設定

### 12.1 反転ルール

| 条件 | 影響 |
|------|------|
| 後刃物台 | G02/G03反転 |
| +Z方向切削 | G02/G03反転 |

---

# 第4部: よくある間違いと対策

## 13. I/K値の間違い

| ミス | 正しい |
|------|--------|
| I = Xc - Xs | I = **(Xc - Xs) / 2** |
| 終点から中心 | **始点**から中心 |
| 直径値で出力 | **半径値**で出力 |

## 14. 角Rと隅Rの混同

| ミス | 正しい |
|------|--------|
| 全てtan(θ/2) | 角R=tan(θ/2)、隅R=**tan(θ)** |
| 中心がコーナー側 | 隅Rの中心は**外側** |

## 15. 溝座標の間違い

| ミス | 正しい |
|------|--------|
| 溝中心でプログラム | 工具基準点を考慮 |
| 工具幅を無視 | 工具幅オフセットを加算 |

---

# 第5部: 本アプリへの実装指針

## 16. 座標計算で考慮すべきこと

1. X軸は**直径値**で出力
2. I値は**半径値**で計算 (`I = (Xc - Xs) / 2`)
3. I/Kは**始点**から中心へのベクトル
4. 角Rと隅Rで正しい計算式を使い分ける
5. 溝入れは工具基準点を考慮

## 17. 工具データで管理すべき項目

| 項目 | 用途 |
|------|------|
| ノーズR | 補正計算 |
| 仮想刃先点番号 | 補正方向判定 |
| 工具幅 | 溝座標計算 |
| 基準位置 | 左端/右端/中央 |

## 18. チェックリスト

- [ ] X座標は**直径値**で出力したか
- [ ] I値は**半径値**で計算したか
- [ ] I/Kは**始点**から中心へのベクトルか
- [ ] 角Rと隅Rで正しい計算式を使ったか
- [ ] 溝入れは工具基準点を考慮したか
- [ ] G02/G03は正しい回転方向か

---

# 第6部: 高度な切削技術知見（将来の拡張用）

## 19. 表面粗さの理論計算

### 19.1 理論表面粗さ (Rz)
ノーズR ($Re$) と送り ($f$) から、理想的な仕上げ面の粗さを計算できます。
```
Rz = (f^2 / (8 × Re)) × 1000 [μm]
```
- $f$: 送り量 [mm/rev]
- $Re$: ノーズR [mm]

### 19.2 実際の粗さ (Ra)
実際の粗さは理論値の 1.5倍〜3倍程度（構成刃先や振動の影響）になります。

---

## 20. リード角と実効チップ厚

### 20.1 チップ厚の変動
ホルダの主切刃角（リード角）によって、同じ送り量でも実際の切りくずの厚さが変わります。
- **90°（SCLCR等）**: 送り量 = チップ厚
- **45°（SSDCN等）**: 送り量 × sin(45°) = チップ厚（約0.7倍に薄くなる）

**活用**: チップ厚が薄くなる角度のホルダを使えば、送りを上げて加工時間を短縮できます。

---

## 21. 高度な干渉回避

### 21.1 禁止領域の設定
NC装置側で設定される「チャック禁止領域」「心押台禁止領域」をソフト側でも考慮することで、事故を未然に防ぎます。

### 21.2 刃物台回転干渉
長いボーリングバイトを使用する場合、刃物台（タレット）が回転する際の旋回半径とワーク・カバーとの干渉チェックが必要です。

---

---
66: 
67: # 第7部: 加工現場のベストプラクティス
68: 
69: ## 22. 周速一定制御 (G96) と最高回転数 (G50)
70: 
71: ### 22.1 周速一定のメリット
72: ワークの径が変わっても切削速度を一定に保つことで、表面粗さが均一になり、工具寿命が安定します。
73: 
74: ### 22.2 G50 の重要性
75: 端面加工などで中心に向かう際、回転数が無限に上がらないよう制限をかけます。
76: - **安全**: 遠心力によるワークの飛び出し防止。
77: - **品質**: 高回転時の振動抑制。
78: 
79: ---
80: 
81: ## 23. ビビリ（振動）対策
82: 
83: ### 23.1 主軸速度変動 (SSV)
84: 回転数を一定周期で上下させることで、共振を防止しビビリを抑制する技術です。細長いワークの加工に有効です。
85: 
86: ### 23.2 突出し（L/D比）のルール
87: 工具やワークの突き出し長さ ($L$) と直径 ($D$) の比率を 3〜4倍以下に抑えるのが基本です。
88: 
89: ---
90: 
91: ## 24. ツールライフ管理
92: 
93: ### 24.1 摩耗の予兆
94: - 加工音が「キーン」と高くなる。
95: - 切りくずの色が青白く（高温）変わる。
96: - 表面に「むしれ」が発生する。
97: 
98: ---
99: 
100: # 第8部: Peter Smid氏の座標幾何学モデル

Peter Smid氏の "CNC Programming Handbook" で提唱されている、CADなしで複雑な輪郭を算出するための高度な幾何学アプローチです。

## 25. テーパーと円弧の接点 (Tangent Points)

テーパー（角度 $\theta$）と円弧（半径 $R$）が滑らかに接続する接点の座標算出。

### 25.1 幾何学的原理
- 円弧の中心 $(X_c, Z_c)$ から接点 $(X_t, Z_t)$ への線は、テーパー線に対して常に垂直（90度）になる。

### 25.2 計算公式 (中心座標基準)
- $X_t = X_c \pm 2 \cdot R \cdot \cos(\theta)$ （直径指令の場合）
- $Z_t = Z_c \pm R \cdot \sin(\theta)$

---

## 26. 異なる角度を持つ二直線の交点冒頭

二つのテーパー（角度 $\alpha$ と $\beta$）が交わる頂点の計算。

### 26.1 正弦定理 (Sine Law) の応用
不規則な三角形の頂点座標を求める際、Smid氏は正弦定理の活用を推奨しています。
$$ \frac{a}{\sin A} = \frac{b}{\sin B} = \frac{c}{\sin C} $$
これにより、図面に明記されていない交点までの距離を算出します。

---

## 27. ノーズR補正の幾何学的シフト量

G41/G42 を使わない「手計算補正」を行う際の、角度に応じた補正値。

### 27.1 Z軸シフト量 ($\Delta Z$)
$$ \Delta Z = R \cdot \tan\left(\frac{90 - \theta}{2}\right) $$
### 27.2 X軸シフト量 ($\Delta X$)
$$ \Delta X = 2 \cdot R \cdot \left[ 1 - \tan\left(\frac{90 - \theta}{2}\right) \cdot \tan\theta \right] $$
※ $\theta$ はワーク軸に対するテーパーの角度。

---

## 28. ねじ切りの切り込み計算 (G76)

### 28.1 定ボリューム切り込み (Constant Volume)
Smid氏は、刃先の負荷を一定にするため、回数 $n$ ごとの切り込み深さ $D_n$ を以下の比率で計算することを解説しています。
$$ D_n = \text{TotalDepth} \cdot \sqrt{\frac{n}{\text{TotalPasses}}} $$
これにより、初回の切り込みを大きく、最終回を小さく制御します。

---

## 29. 円弧と円弧の接点 (Arc to Arc Tangent)

二つの円弧が滑らかに繋がる接続点 $(X_t, Z_t)$ の算出。

### 29.1 中心間距離 $L$ の計算
$$ L = \sqrt{(X_{c2} - X_{c1})^2 + (Z_{c2} - Z_{c1})^2} $$
### 29.2 接点座標の比例計算
円弧1（半径 $R_1$）と円弧2（半径 $R_2$）の接点は、二つの中心を結ぶ線分を $R_1 : R_2$ の比で分割した点になる。
- $X_t = X_{c1} + (X_{c2} - X_{c1}) \cdot \frac{R_1}{R_1 + R_2}$
- $Z_t = Z_{c1} + (Z_{c2} - Z_{c1}) \cdot \frac{R_1}{R_1 + R_2}$

---

## 30. ねじ切りの助走距離と不完全ねじ部

主軸回転と送りが同期するまでの「助走（Lead-in）」距離。

### 30.1 Smid氏の推奨計算式
同期を安定させるための最小助走距離 $L_{in}$ ：
$$ L_{in} = \frac{\text{Pitch} \times \text{RPM}}{500} \text{ [mm]} $$
（※ 一般的な目安としてピッチの2倍〜3倍以上を推奨）

---

## 31. 座標シフト (G52) とローカル座標系

サブプログラム内で特定の形状を繰り返す際、Smid氏はワーク座標系 (G54-G59) ではなく G52 による一時的なシフトを活用し、形状プログラムの汎用性を高める手法を詳述しています。

---

## 32. ドリル先端のポイント長計算 (Drill Point Length)

穴あけ加工において、ドリルの「肩（全径）」が所定の深さに達するために必要な、先端ポイント分の追加深さを算出します。

### 32.1 算出公式
$$ \Delta Z = \frac{D/2}{\tan(\theta/2)} $$
- $D$: ドリル径
- $\theta$: 先端角 (標準 118°, ステン・硬材 135°)

**早見定数 (118°の場合)**:
$$ \Delta Z \approx D \times 0.3 $$
（例: 10φのドリルなら、先端は約 3mm 突き出している）

---

## 33. 理論表面粗さと幾何学的関係 (Surface Roughness Geometry)

ノーズR ($Re$) と送り量 ($F$) から、幾何学的な最大高さ粗さ ($Rz$) を予測。

### 33.1 算出公式 (Smid式)
$$ Rz \approx \frac{F^2}{8 \cdot Re} \cdot 1000 \text{ [μm]} $$
逆に、目標とする表面粗さを得るための最大送り量は：
$$ F \approx \sqrt{\frac{8 \cdot Re \cdot Rz}{1000}} \text{ [mm/rev]} $$

---

## 34. テーパー管用ねじ (NPT / PT) の幾何定義

管用ねじのような 1/16 テーパーを持つねじの始終点 X 座標を算出します。

### 34.1 基本データ
- **テーパー比**: 1 : 16
- **テーパー角 (片角)**: $1^\circ 47' 24'' \approx 1.7899^\circ$
- **勾配**: 0.0625 [mm/mm]

### 34.2 座標計算
基準位置の直径を $D_{ref}$ 、そこからの距離を $L$ とすると：
$$ X = D_{ref} \pm (L \cdot 0.0625 \cdot 2) $$ (直径値)

---

## 35. 高度な交点計算 (Advanced Points of Intersection)

### 35.1 直線と円弧の交点 (Line & Circle)
テーパー線 $Z = aX + b$ と円 $(X-X_c)^2 + (Z-Z_c)^2 = R^2$ の連立方程式による交点算出。CADが使えない状況での最終手段として教本に紹介されています。

### 35.2 中心位置の特定 (Radius from 2 Points)
始点と終点、および半径 $R$ だけが既知の場合、ピタゴラスの定理を応用して中心 $(I, K)$ を逆算します。
- 弦の半分 $d = \sqrt{(Xs-Xe)^2 + (Zs-Ze)^2} / 2$
- 中心から弦までの距離 $h = \sqrt{R^2 - d^2}$
- この幾何学的関係から中心座標を特定します。

# 第9部: 工場長のネタ帳（HP）流の現場計算式

日本の加工現場で広く親しまれている「工場長のネタ帳」に基づいた、直感的でミスの少ない計算手法です。

## 32. テーパー・円弧接続の「戻り量」

図面上の仮想交点（カド）から、円弧（R）が始まる接点までの距離 $L$ の算出。

### 32.1 基本公式
$$ L = R \cdot \tan\left(\frac{\theta}{2}\right) $$
- $R$: 円弧半径
- $\theta$: 旋回角（方向が変化する角度）

**活用**: テーパーの終点（カド）の座標から、$L$ 分だけ手前でRを開始すれば良いことが直感的に分かります。

---

## 33. HP流ノーズR補正式（手計算用）

ノーズR補正機能を使わずに、プログラム座標を直接書き換える際の公式。

### 33.1 補正量 ($f_x, f_z$)
テーパー片角 $\theta$ に対して：
- $$ f_x = 2 \cdot R \cdot \left( 1 - \tan\frac{\theta}{2} \right) $$ (直径値)
- $$ f_z = R \cdot \left( 1 - \tan\frac{\theta}{2} \right) $$

**注意**: これは「仮想刃先」から「実刃先（Rの中心を通る線）」へのシフト量として計算されます。

---

## 34. 段差がRより小さい場合の計算

### 34.1 幾何学的アプローチ
段差 $h$ が半径 $R$ より小さい場合、三平方の定理を用いて接点 $Z$ を求めます。
$$ \Delta Z = \sqrt{R^2 - (R - h)^2} $$
この $\Delta Z$ を基準点に加算することで、接点座標を特定します。

---

## 参考資料・Webサイト

### 総合技術情報
- [三菱マテリアル - 切削加工の基礎](https://www.mmbible.com/) (切削理論の宝庫)
- [京セラ - 切削工具テクニカルガイド](https://www.kyocera.co.jp/prince/tool/technical/) (計算式が充実)
- [住友電工 - 切削加工解説](https://www.sumitool.com/technolab/)

### 実践・計算ツール
- [工場長のネタ帳](https://koujoucho-neta.com/) (現場感覚の座標計算)
- [Sandvik Coromant - 切削条件計算](https://www.sandvik.coromant.com/ja-jp/knowledge/machining-formulas-definitions/pages/turning.aspx)

### 専門ブログ
- [職人の転職 - NC旋盤の基本](https://shokunin-tenshoku.com/)
- [NC旋盤の教科書](https://s-projects.net/)
```
