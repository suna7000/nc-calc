# ノーズR補正計算式 完全リファレンス

## 出典
- 教科書 9-20～9-22ページ「刃先R補正の具体的計算方法」

---

## 基本計算式

### 正刃（通常の切削方向）
```
fx = 2R(1 - tan(φ/2))    φ = 90° - θ
fz = R(1 - tan(θ/2))
```

### 逆刃（刃の背中で削る場合）
```
fx = 2R(1 + tan(φ/2))    φ = 90° - θ
fz = R(1 + tan(θ/2))
```

---

## 計算式の使い分け条件

| 条件 | fx式 | fz式 |
|------|------|------|
| 正刃・下りテーパー | `1-tan(φ/2)` | `1-tan(θ/2)` |
| 正刃・上りテーパー | `1-tan(φ/2)` | `1-tan(θ/2)` |
| 逆刃・下りテーパー | `1+tan(φ/2)` | - |
| 逆刃・上りテーパー | - | `1+tan(θ/2)` |

**判定ルール:**
- 正刃/逆刃は「工具の進行方向と刃先の向きの関係」で決まる
- 下りテーパー: Xが減少する方向
- 上りテーパー: Xが増加する方向

---

## 適用方法（加算/減算）

### 教科書の例（9-21ページ）
```
θ = 60°, R = 0.8 の上りテーパー
fx = 2 × 0.8 × (1 - tan(15°)) = 1.17
XP₁ = 50 - fx = 48.83
```

### ルール
1. **fxの適用:**
   - 上りテーパー終点: X - fx
   - 上りテーパー始点: X - fx
   - 下りテーパー終点: X + fx（未確認）
   - 下りテーパー始点: X + fx（未確認）

2. **fzの適用:**
   - -Z方向切削: Z - fz
   - +Z方向切削: Z + fz

---

## ユーザー手書き図との照合

| パターン | 形状 | 手書き式 | 教科書 | 一致 |
|----------|------|----------|--------|------|
| 1 | 下りテーパー→隅R | `R(1+tan)` | 逆刃=`1+tan` | ✓ |
| 3 | 隅R→上りテーパー | `R(1-tan)` | 正刃=`1-tan` | ✓ |
| 4 | 上りテーパー→角R | `R(1-tan)` | 正刃=`1-tan` | ✓ |
| 9 | 上りテーパー→隅R | `2R(1-tan(φ/2))` | 正刃=`1-tan` | ✓ |

---

## 検証が必要な項目

1. 適用方法（加算/減算）の完全なルール
2. パターン10の正誤確認
3. コーナーR部分の特殊処理

## 次のステップ

1. 具体的な数値例で計算を検証
2. ユーザーの正解値と照合
3. コード実装
