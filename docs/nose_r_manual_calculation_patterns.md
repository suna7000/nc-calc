# ノーズR補正 手計算検証用パターン

本ドキュメントは、計算エンジンの数学的正当性を「自分を疑う」視点で再監査するための基準値である。

## 1. 直線-直線（テーパー）接続時の補正量
角度 $\theta$ (片角) のテーパーと Z 軸平坦面の接続点において、ノーズR $R$ による補正量 $(fx, fz)$ は以下の通り：

$$ fz = R \tan(\theta/2) $$
$$ fx = 2R(1 - \tan((90-\theta)/2)) $$ (直径値)

### 検証ケース：45度テーパー (X100 Z0 -> X120 Z-10, R=0.8)
- $\theta = 45^\circ$
- $fz = 0.8 \times \tan(22.5^\circ) \approx 0.8 \times 0.4142 = 0.331$
- 理論シフト量: Z方向に 0.331 戻る。

## 2. 二等分線投影法 (Bisector Projection)
セグメント間の角度を $\alpha$ とすると、補正後の点 $P$ は交点 $O$ から二等分線方向に距離 $d$ だけオフセットされる。

$$ d = \frac{R}{\cos(\alpha/2)} $$

この式が、角度 $1^\circ$ や $179^\circ$ の極限で発散せず、物理的に正しい刃先位置を示すかを監査する。

## 3. チップ番号と座標系オフセット (Fanuc規格)
$O$ (仮想刃先), $P$ (工具中心) とすると：

| Tip No. | 方向 | 物理的配置 $P$ relative to $O$ | 実装 $O$ relative to $P$ |
|:---:|:---|:---|:---|
| 3 | 外径/前 | $P = O + (2R, -R)$ | $O = P + (-2R, R)$ |
| 2 | 内径/前 | $P = O + (-2R, -R)$| $O = P + (2R, R)$ |
| 7 | 端面裏 | $P = O + (0, R)$ | $O = P + (0, -R)$ |

※座標系：直径指定、Zマイナスが切り込み方向。

## 4. 円弧補正の半径
凸円弧(G02)の補正半径 $R_c$:
$$ R_c = R_{shape} + R_{nose} $$
凹円弧(G03)の補正半径 $R_c$:
$$ R_c = R_{shape} - R_{nose} $$

この半径が `noseRCompensation.ts` の `calculateArcOffset` と 1bit の誤差もなく一致しているかを監査する。
