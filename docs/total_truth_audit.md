# 全シナリオAI独立数学監査 (Total Truth Audit) 定義書

本ドキュメントは、アプリケーションの実装ロジックを一切参照せず、AIが数学的知見のみを用いて算出した「真の座標」を定義するものである。これをマスターテストマトリックスと照合し、1μmの誤差も許さない厳格な監査を行う。

## 1. 幾何学定義 (Geometry - G)

| ID | 名称 | 数学的期待値（理論値ベース） |
|:---|:---|:---|
| G-01 | 基本直線 | (100,0) -> (100,-50) -> (120,-50) : **単純座標一致** |
| G-02 | テーパー | (90,0) -> (100,-20) : **斜辺勾配 0.25 (1/4)** |
| G-03 | 角R (凸) | 段差カドに半径Rの円弧を外接させる。接点は幾何学的交点から戻った位置。 |
| G-04 | 隅R (凹) | 段差カドに半径Rの円弧を内接させる。 |
| G-05 | 面取り (C) | 軸に対して45度の直線を挿入。 |
| G-06 | S字接続 | 二円が共通接線、または変曲点で接する。接点での一次微分（勾配）が一致。 |
| G-07 | 複合R | R1の終点勾配がR2の始点勾配と一致していること。二円の外接計算。 |
| G-08 | 溝展開 | 座標から深さ/幅を単純加減算した座標群。 |
| G-09 | テーパー連続R | 二直線 $L_1, L_2$ の挟角を $\alpha$ とすると、中心は二等分線上の距離 $d = R/\sin(\alpha/2)$ に位置する。接点は交点から $R/\tan(\alpha/2)$ 戻った位置。 |
| G-10 | 多層連続R | 各接続点 $k$ において $\vec{t}_{k, out} = \vec{t}_{k+1, in}$ (接ベクトルの一致) が真理。 |
| G-11 | ジグザグ | 符号反転による G02/G03 の物理的反転の正当性。 |
| G-12 | 特殊溝 | 壁角度 $\theta$ に対して座標 $X = X_0 + \Delta Z / \tan(\theta)$。 |

### 数学的定数・公式
- **Bisector Distance**: $D = R \cdot \csc(\alpha/2)$
- **Tangent Point Offset**: $T = R \cdot \cot(\alpha/2)$
- **Arc Center (External)**: $(Xc, Zc) = (X_v \pm 2D \sin(\phi), Z_v \pm D \cos(\phi))$ ※$\phi$ は二等分線角

## 2. 工具補正定義 (Compensation - C)

| ID | 名称 | AI独立数学モデル |
|:---|:---|:---|
| C-01 | 補正OFF | $\Delta X = 0, \Delta Z = 0$ |
| C-02 | 補正ON | $\Delta X = 2R, \Delta Z = R$ (Tip 3/外径/直径指定時) |
| C-03 | 後刃物台/+Z | 鏡像座標系およびベクトル反転の整合性。 |
| C-04 | 全チップ定義 | **Vector Table (P = O + V)**: <br> Tip 3: ($+R, +R$), Tip 2: ($-R, -R$), Tip 1: ($-R, +R$)... <br> ※これは物理的な刃先の位置関係と厳密に一致しなければならない。（Xは半径値、計算時は直径2倍） |
| C-05 | 内径補正 | $X$ 座標シフト方向が $X_{center}$ 側。 |
| C-06 | 端面補正 | $Z$ 座標または $X$ 座標の片側オフセット（二等分線が軸平行）。 |
| C-07 | 干渉判定 | 幾何形状とホルダ干渉角の不等式評価。 |

## 3. 異常系定義 (Edge Case - E)

| ID | 名称 | 数学的極限挙動 |
|:---|:---|:---|
| E-01 | R過大調整 | $R_{adj} = \min(R, \text{segment length} \cdot \text{scale})$ |
| E-02 | 極小段差 | 浮動小数点 $\epsilon$ （$1e-9$程度）以上での計算安定。 |
| E-03 | 同一線上3点 | 三点の外積がゼロの場合、単一の直線として統合。 |
| E-04 | 逆走座標 | ベクトル内積が負になる場合のハンドリング（ワーニング出力）。 |

---
以上の「真理値」を基準に、実装コードを再判定する。
