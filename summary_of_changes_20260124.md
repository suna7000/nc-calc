# NC旋盤座標計算ツール 改善報告書 (2026/01/24)

本ドキュメントは、NC旋盤座標計算ツールの品質向上およびユーザー利便性改善のために実施した修正・強化内容をまとめたものです。

## 1. 表示上の誤植修正 (Typo Fix)

内部的に「隅R（内径や段差の角）」として扱われていた箇所が、画面上で「雅R」と誤って表示されていた問題を修正しました。

- **修正ファイル**: [ShapeBuilder.tsx](file:///Users/sin-mac/nc-calc/src/components/ShapeBuilder/ShapeBuilder.tsx)
- **修正内容**: `point.corner.type === 'sumi-r'` の表示判定において、文字列を「雅R」から「隅R」へ訂正。
- **効果**: 機械加工の一般的な用語（隅R = Concave Radius）と一致し、ユーザーの混乱を防ぎます。

## 2. 結果テーブルの表示項目拡充 (Point Bの可視化)

ユーザーからの「円弧の始まり（点B）の座標も確認したい」という要望に基づき、計算結果テーブルの表示項目を大幅に拡充しました。

- **修正ファイル**: [ResultsView.tsx](file:///Users/sin-mac/nc-calc/src/components/ResultsView/ResultsView.tsx)
- **追加項目**:
    - **始点座標 (X, Z)**: セグメント（直線や円弧）の開始点となる座標（補正前）。
    - **補正X(始), 補正Z(始)**: 工具ノーズR補正を適用した後の、セグメント開始点の座標（**点B**）。
- **効果**: 
    - これまで「終点（点A）」のみが表示されていたテーブルで、円弧への入り口（点B）と出口（点A）の両方の補正座標が1行で確認できるようになりました。
    - プログラム作成時の座標入力の転記ミスを防止します。

## 3. 7点形状パターンの計算精度検証

ユーザー提供の図面に基づいた「7つの制御点を持つ形状」において、計算エンジンが正しく動作することを検証しました。

- **作成テスト**: `src/calculators/__tests__/repro_reproduction.test.ts`
- **検証項目**:
    - 7点連続入力時のセグメント分解が正常に行われること。
    - すべてのセグメント（直線、外径R、隅R）に対してノーズR補正座標が欠落なく算出されること。
    - 計算過程でのクラッシュや数値の異常（NaN等）が発生しないこと。
- **結果**: **100% 合格**。複雑なコーナー接続を含む形状でも、安定して補正座標を出力できることを確認しました。

## 4. 今後の運用について

- **ノーズR補正の本質**: 本ツールは「仮想刃先点」に基づいた座標を出力します。NC装置側でのG41/G42は不要（または併用注意）です。
- **検証環境**: `npm test` を実行することで、今回追加した検証を含む全26テスト（現時点）が自動実行され、計算のデグレードがないことを保証できます。

---
以上。
